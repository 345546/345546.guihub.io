<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>文件分享页</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,sans-serif}
body{background:#f6f8fa;padding:30px 20px;max-width:800px;margin:0 auto}
.online{background:#0969da;color:white;padding:14px 20px;border-radius:10px;text-align:center;margin-bottom:30px}
.box{background:white;border-radius:12px;padding:30px;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
h2{margin-bottom:20px;text-align:center}
.upload{border:2px dashed #d1d9e0;border-radius:10px;padding:40px 20px;text-align:center;cursor:pointer}
.upload:hover{border-color:#0969da}
#file{display:none}
.btn{background:#0969da;color:white;border:none;padding:10px 20px;border-radius:8px;margin-top:20px;cursor:pointer}
.btn:disabled{background:#8c959f;cursor:not-allowed}
.down{margin-top:20px;padding:15px;background:#f6f8fa;border-radius:8px;word-break:break-all;display:none}
a{color:#0969da}
</style>
</head>

<body>
<div class="online" id="online">加载在线人数...</div>

<div class="box">
  <h2>文件上传 & 下载</h2>
  <label class="upload" id="dropArea">
    <p>点击或拖拽文件上传</p>
    <input type="file" id="file">
  </label>
  <button class="btn" id="copyBtn" disabled>复制下载链接</button>
  <div class="down" id="result"></div>
</div>

<script>
// ======================================
// 稳定在线人数（免费稳定不卡顿，GitHub专用）
// ======================================
async function loadOnline() {
  try {
    const r = await fetch("https://api.lhlyun.com/online", { signal: AbortSignal.timeout(3000) });
    const t = await r.text();
    document.getElementById("online").textContent = "当前在线：" + t + " 人";
  } catch (e) {
    document.getElementById("online").textContent = "当前在线：加载失败（不影响上传下载）";
  }
}
loadOnline();

// ======================================
// 文件上传 + 下载 + 拖拽
// ======================================
const fileInput = document.getElementById("file");
const result = document.getElementById("result");
const copyBtn = document.getElementById("copyBtn");
const dropArea = document.getElementById("dropArea");
let fileUrl;

fileInput.addEventListener("change", () => {
  const f = fileInput.files[0];
  if (!f) return;
  if (fileUrl) URL.revokeObjectURL(fileUrl);
  fileUrl = URL.createObjectURL(f);
  result.innerHTML = `文件名：${f.name}<br><a href="${fileUrl}" download="${f.name}">点此下载</a>`;
  result.style.display = "block";
  copyBtn.disabled = false;
});

copyBtn.onclick = () => {
  if (!fileUrl) return;
  navigator.clipboard.writeText(fileUrl).then(() => alert("已复制链接"));
};

["dragenter", "dragover", "dragleave", "drop"].forEach(e => dropArea.addEventListener(e, t => t.preventDefault()));
dropArea.addEventListener("drop", e => {
  fileInput.files = e.dataTransfer.files;
  fileInput.dispatchEvent(new Event("change"));
});
</script>
</body>
</html>

